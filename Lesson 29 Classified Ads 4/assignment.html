<!DOCTYPE html>
<!-- saved from url=(0038)https://www.dj4e.com/assn/dj4e_ads4.md -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style>body {transition: opacity ease-in 0.2s; } 
body[unresolved] {opacity: 0; display: block; overflow: hidden; position: relative; } 
</style>
        
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>DJ4E - Django for Everybody</title>
<script>
 var _TSUGI = {
            context_title: "Django for Everybody",
            ajax_session: false,
heartbeat: 1500000,
heartbeat_url: "https://www.dj4e.com/tsugi/util/heartbeat?msec=1500000",
rest_path: {"parent":"\/assn","base_url":"https:\/\/www.dj4e.com","controller":"dj4e_ads4.md","extra":"","action":false,"parameters":[],"current":"\/assn\/dj4e_ads4.md","full":"\/assn\/dj4e_ads4.md"},
spinnerUrl: "https://static.tsugi.org/img/spinner.gif",
staticroot: "https://static.tsugi.org",
apphome: "https://www.dj4e.com",
wwwroot: "https://www.dj4e.com/tsugi",
websocket_url: false,
websocket_token: false,
window_close_message: "Application complete",
session_expire_message: "Your session has expired"

}
</script>
        <!-- Tiny bit of JS -->
        <script src="./assignment_files/tsugiscripts_head.js"></script>
        <!-- Le styles -->
        <link href="./assignment_files/bootstrap.min.css" rel="stylesheet">
        <link href="./assignment_files/jquery-ui.min.css" rel="stylesheet">
                <link href="./assignment_files/all.css" rel="stylesheet">
        <link href="./assignment_files/v4-shims.css" rel="stylesheet">
        <style>:root {--primary:#0a4b33;
--primary-menu:#0a4b33;
--primary-border:#0a4630;
--primary-darker:#09442e;
--primary-darkest:#093e2b;
--background-color:#FFFFFF;
--secondary:#EEEEEE;
--secondary-menu:#EEEEEE;
--text:#111111;
--text-light:#5E5E5E;
--font-family:'Roboto', Corbel, Avenir, 'Lucida Grande', 'Lucida Sans', sans-serif;
--font-size:14px;
}</style>
          <link href="./assignment_files/tsugi2.css" rel="stylesheet">

          <style>
                        </style>
<style>
a[target="_blank"]:after {
    font-family: 'Font Awesome 5 Free';
    font-weight: 600;
    content: " \f35d";
}
.goog-te-banner-frame.skiptranslate {
    display: none !important;
    }
body {
    top: 0px !important;
    }
</style>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://www.dj4e.com/tsugi/vendor/tsugi/lib/static/js/html5shiv/html5shiv.js"></script>
          <script src="https://www.dj4e.com/tsugi/vendor/tsugi/lib/static/js/respond/respond.min.js"></script>
        <![endif]-->

    <script type="text/javascript">CSRF_TOKEN = "TODORemoveThis";</script>
</head>
<body prefix="oer: http://oerschema.org" style="padding-top: 5.93rem;">
<div id="body_container" class="container">
<script>
if (window!=window.top) {
    document.getElementById("body_container").className = "container-fluid";
} else {
    document.getElementById("body_container").className = "container";
}
</script>
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation" id="tsugi_main_nav_bar" style="display: block;">  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://www.dj4e.com/" target="_self">DJ4E</a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-main">
        <li><a href="https://www.dj4e.com/lessons" target="_self">Lessons</a></li>
        <li><a href="https://www.dj4e.com/discussions" target="_self">Discussions</a></li>
        <li><a href="https://www.dj4e.com/assignments" target="_self">My Progress</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="http://www.dr-chuck.com/" target="_blank">Instructor</a></li>
        <li class="dropdown">
          <a href="https://www.dj4e.com/assn/dj4e_ads4.md#" class="dropdown-toggle dropdown-img" data-toggle="dropdown"><img src="./assignment_files/unnamed.png" title="User Profile Menu - Includes logout" style="height: 2em;"> <span class="fa fa-caret-down" aria-hidden="true"></span></a>
          <ul class="dropdown-menu">
            <li><a href="https://www.dj4e.com/profile" target="_self">Profile</a></li>
            <li><a href="https://www.dj4e.com/map" target="_self">Map</a></li>
            <li><a href="https://www.tsugicloud.org/" target="_blank">Free App Store</a></li>
            <li><a href="https://www.dj4e.com/tsugi/store" target="_self">Test LTI Tools</a></li>
            <li><a href="https://www.dj4e.com/logout" target="_self">Logout</a></li>
          </ul>
        </li>
      </ul>
    </div> <!--/.nav-collapse -->
  </div> <!--container -->
</nav>
<script>
if ( ! inIframe() ) {
  document.getElementById('tsugi_main_nav_bar').style.display = 'block';
  document.getElementsByTagName('body')[0].style.paddingTop = '5.93rem';
} else {
  document.getElementsByTagName('body')[0].style.paddingTop = '1.0rem';
}
</script>
<div id="flashmessages"></div><style>
center {
    padding-bottom: 10px;
}
@media print {
    #chapters {
        display: none;
    }
}
a[target="_blank"]:after {
  content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAQElEQVR42qXKwQkAIAxDUUdxtO6/RBQkQZvSi8I/pL4BoGw/XPkh4XigPmsUgh0626AjRsgxHTkUThsG2T/sIlzdTsp52kSS1wAAAABJRU5ErkJggg==);
  margin: 0 3px 0 5px;
}
</style>


<div id="body_container">
<script>
if (window!=window.top) {
    document.getElementById("body_container").className = "container-fluid";
} else {
    document.getElementById("body_container").className = "container";
}
</script>
<script>
function onSelect() {
    console.log($('#chapters').val());
    window.location = $('#chapters').val();
}
</script>
<div style="float:right">
<select id="chapters" onchange="onSelect();">
  <option value="dj4e_install.md">Django and PythonAnywhere</option>
  <option value="dj4e_html.md">Adding HTML</option>
  <option value="dj4e_tut01.md">Serving Dynamic Content</option>
  <option value="dj4e_tut02.md">Django Models</option>
  <option value="dj4e_tut03.md">Django Views</option>
  <option value="dj4e_tut04.md">Django Forms</option>
  <option value="dj4e_hello.md">Hello Session World</option>
  <option value="dj4e_load.md">Batch Loading Data</option>
  <option value="dj4e_autos.md">Login / Autos CRUD</option>
  <option value="dj4e_local.md">Installing Django Locally</option>
  <option value="dj4e_github.md">Using GitHub</option>
  <option value="dj4e_ads1.md">AdList Milestone #1</option>
  <option value="dj4e_ads2.md">AdList Milestone #2</option>
  <option value="dj4e_ads3.md">AdList Milestone #3</option>
  <option value="dj4e_ads4.md" selected="">AdList Milestone #4</option>
</select>
</div>
<h1>Classified Ad Web Site - Milestone 4</h1>
<p>In this assignment, you will expand your classified ads web site to add search and tags
functionality equivalent to:</p>
<p><a href="https://chucklist.dj4e.com/m4" target="_blank">https://chucklist.dj4e.com/m4</a></p>
<p><em>Important</em>: The number of lines you need to add to your code is <em>relatively</em> small.  Take your time
read the sample code carefully - only make changes that you understand.  Wholesale cutting and
pasting sample code will make it almost impossible to complete this assignment.</p>
<p>This is somewhat like the kind of real work you do when you have a working application and want to add a feature
the the application.  First - don't break what you have working.</p>
<h2>Adding Search</h2>
<p>The <code>well</code> sample application contains code you can adapt to implement the code to search
the title and text:</p>
<p><a href="https://samples.dj4e.com/well/" target="_blank">https://samples.dj4e.com/well/</a></p>
<p>To avoid getting too much broken at one time - it is probably a good idea to make search work
and then further evolve your code to support tags.</p>
<h2>Adding Support for Tags</h2>
<p>The <code>tagme</code> application adds a <code>tags</code> field to the model and and adds support for tags
to the user interface and search code.</p>
<p><a href="https://samples.dj4e.com/tagme/" target="_blank">https://samples.dj4e.com/tagme/</a></p>
<p>You should also review the documentation for the <code>django-taggit</code> library at:</p>
<p><a href="https://django-taggit.readthedocs.io/en/latest/" target="_blank">https://django-taggit.readthedocs.io/en/latest/</a></p>
<p>You might find the easiest path is to use the <code>taggit</code> documentation to make your changes,
looking at the <code>tagme</code> code to verify what you are doing.</p>
<p>There is a bit of an extra wrinkle when adapting the approach in <code>tagme</code> because we are
using a ModelForm in order to process uploaded pictures.  The key is that you have to
save the tags after the form has been copied to the model and the model has been saved because
the tags are stored using a many-to-many data model.</p>
<p><a href="https://django-taggit.readthedocs.io/en/latest/forms.html#commit-false" target="_blank">https://django-taggit.readthedocs.io/en/latest/forms.html#commit-false</a></p>
<p>In your <code>forms.py</code> code you will need to (a) add 'tags' to the field list and (b) update the
code in the commit to look like:</p>
<pre><code>    if commit:
        instance.save()
        self.save_m2m()    # Add this</code></pre>
<p>In your <code>views.py</code>, we have our own code to pull data from the form to the model and then
save the model.  This code is in both the insert and edit views:</p>
<pre><code>    # Adjust the model owner before saving
    inst = form.save(commit=False)
    inst.owner = self.request.user
    inst.save()

    # https://django-taggit.readthedocs.io/en/latest/forms.html#commit-false
    form.save_m2m()    # Add this</code></pre>
<p>You need to add the <code>save_m2m()</code> call <em>after</em> the instance was saved.</p>
<h2>Manual Testing</h2>
<p>It is always a good idea to manually test your application before submitting it for grading.  Here
are a set of manual test steps:</p>
<ul>
<li>
<p>Log in to your application and create several ads add a tag to one of the ads.  Make sure that
you put unique words that are only in the title, text, and tag so you can verify that you can search
for a word in any of the three places.</p>
</li>
<li>
<p>Go into the detail page for an ad and verify that it shows you the title, text, and tag(s) that you entered</p>
</li>
<li>
<p>Make sure to edit an ad and verify that you are able to change the title, text, and tags.</p>
</li>
<li>
<p>Search for some text that is only in a title and verify that the correct ads come back.</p>
</li>
<li>
<p>Search for some text that is only in a body and verify that the correct ads come back.</p>
</li>
<li>
<p>Search for some text that is only in a tag and verify that the correct ads come back.</p>
</li>
<li>
<p>Note the "?search=" in the location bar in your browser while you are doing searched</p>
</li>
<li>Clear the search and see all of the results and verify there is no "?search=" get parameter</li>
</ul><script src="./assignment_files/jquery-1.11.3.js"></script>
<script src="./assignment_files/bootstrap.min.js"></script>
<script src="./assignment_files/jquery-ui.min.js"></script>
<script src="./assignment_files/jquery.timeago-1.6.3.js"></script>
<script src="./assignment_files/handlebars-v4.0.2.js"></script>
<script src="./assignment_files/tmpl.min.js"></script>
<script src="./assignment_files/tsugiscripts.js"></script>
<script type="text/javascript">
    HEARTBEAT_TIMEOUT = setTimeout(doHeartBeat, _TSUGI.heartbeat);
    tsugiEmbedMenu();
    $(document).ready(function() { jQuery("time.timeago").timeago(); });
</script>

<p style="font-size: 75%; margin-top: 5em;">
Copyright Creative Commons Attribution 3.0
</p><script>
$('a').each(function (x) {
    var href = $(this).attr('href');
    if ( ! href ) return;
    if ( ! href.startsWith('#') ) return;
    var pos = href.indexOf('/?');
    if ( pos < 1 ) return;
    console.dir('Patching broken # href='+href);
    href = href.substring(0,pos);
    $(this).attr('href', href);
});

</script>
<script>
// https://stackoverflow.com/questions/7901679/jquery-add-target-blank-for-outgoing-link
$(window).load(function() {
    $('a[href^="http"]').attr('target', function() {
      if(this.host == location.host) return '_self'
      else return '_blank'
    });
});
</script>

</div>

</div><script src="./assignment_files/webcomponents-lite.js"></script></body></html>